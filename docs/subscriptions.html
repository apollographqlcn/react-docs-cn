<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Subscriptions | Apollo React Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://apollographqlcn.github.io/react-docs-cn">
    <meta property="og:title" content="Subscriptions | Apollo React Docs">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@apollographqlcn">
    <meta name="twitter:title" content="Subscriptions | Apollo React Docs">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/react-docs-cn/style/style.css">
  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      
      <a class="logo-wrapper" href="http://dev.apollodata.com/" title="Apollo Developers"  >
        <img src="images/logo-apollo-space-left.svg" alt="Apollo" class="logo"/><img src="images/logo-apollo-subbrands-developers-space.svg" class="logo-subbrand" alt="Developers"/>
      </a>
    </div>
  </div>

  <div class="nav-group right">
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/react"  >
          <span>React</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/angular2"  >
          <span>Angular</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/ios"  >
          <span>iOS</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/android"  >
          <span>Android</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/core"  >
          <span>Vanilla JS</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false separator">
        <a class="link" href="http://dev.apollodata.com/tools"  >
          <span>Server</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://medium.com/apollo-stack" target=_new >
          <span>Blog</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/community"  >
          <span>Community</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http:/dev.apollodata.com/" title="Apollo"  >
        <span>Apollo Developers</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/react"  >
          <span>React</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/angular2"  >
          <span>Angular</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/ios"  >
          <span>iOS</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/android"  >
          <span>Android</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/core"  >
          <span>Vanilla JS</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/tools"  >
          <span>Server</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="https://medium.com/apollo-stack" target=_new >
          <span>Blog</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/community"  >
          <span>Community</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Apollo React Docs</span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search React Guide" id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="initialization.html" class="sidebar-link ">
                  <span>Setup and options</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="simple-example.html" class="sidebar-link ">
                  <span>Small Example: Snack</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-schema.html" class="sidebar-link ">
                  <span>Full Example: GitHunt</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="migration.html" class="sidebar-link ">
                  <span>Migrating to 1.0</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Usage</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="queries.html" class="sidebar-link ">
                  <span>Queries</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="mutations.html" class="sidebar-link ">
                  <span>Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Subscriptions</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="receiving-updates.html" class="sidebar-link ">
                  <span>Syncing with the Server</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="cache-updates.html" class="sidebar-link ">
                  <span>Updating the Store</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API Reference</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="api.html" class="sidebar-link ">
                  <span>General</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-graphql.html" class="sidebar-link ">
                  <span>graphql: Container</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-queries.html" class="sidebar-link ">
                  <span>graphql: Queries</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-mutations.html" class="sidebar-link ">
                  <span>graphql: Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-server.html" class="sidebar-link ">
                  <span>Server Side Rendering</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Recipes</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="auth.html" class="sidebar-link ">
                  <span>Authentication</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="pagination.html" class="sidebar-link ">
                  <span>Pagination</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="optimistic-ui.html" class="sidebar-link ">
                  <span>Optimistic UI</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="fragments.html" class="sidebar-link ">
                  <span>Using Fragments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="prefetching.html" class="sidebar-link ">
                  <span>Prefetching data</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="react-native.html" class="sidebar-link ">
                  <span>Integrating with React Native</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="redux.html" class="sidebar-link ">
                  <span>Integrating with Redux</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="webpack.html" class="sidebar-link ">
                  <span>Webpack loader</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="server-side-rendering.html" class="sidebar-link ">
                  <span>Server Side Rendering</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Subscriptions</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/apollographqlcn/react-docs-cn/tree/master/source/subscriptions.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <p>In addition to fetching data using queries and modifying data using mutations, the GraphQL spec will soon be gaining a third operation type, called <code>subscription</code>. You can <a href="https://github.com/facebook/graphql/blob/master/rfcs/Subscriptions.md" target="_blank" rel="external">read the RFC on GitHub</a>. While minor changes in the specification might happen before it’s finalized, you can use subscriptions today with Apollo.</p>
<p>GraphQL subscriptions are a way to push data from the server to the clients that choose to listen to real time messages from the server. Subscriptions are similar to queries in that they specify a set of fields to be delivered to the client, but instead of immediately returning a single answer, a result is sent every time a particular event happens on the server.</p>
<p>A common use case for subscriptions is notifying the client side about particular events, for example the creation of a new object, updated fields and so on.</p>
<h2 id="overview">Overview</h2>

<p>GraphQL subscriptions have to be defined in the schema, just like queries and mutations:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">type Subscription &#123;</div><div class="line">  commentAdded(repoFullName: <span class="built_in">String</span>!): Comment</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>On the client, subscription queries look just like any other kind of operation:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">subscription onCommentAdded($repoFullName: <span class="built_in">String</span>!)&#123;</div><div class="line">  commentAdded(repoFullName: $repoFullName)&#123;</div><div class="line">    id</div><div class="line">    content</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The response sent to the client looks as follows:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"data"</span>: &#123;</div><div class="line">    <span class="attr">"commentAdded"</span>: &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="string">"123"</span>,</div><div class="line">      <span class="attr">"content"</span>: <span class="string">"Hello!"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In the above example, the server is written to send a new result every time a comment is added on GitHunt for a specific repository. Note that the code above only defines the GraphQL subscription in the schema. Read <a href="#subscriptions-client">setting up subscriptions on the client</a> and <a href="http://dev.apollodata.com/tools/graphql-subscriptions/index.html">setting up GraphQL subscriptions for the server</a> to learn how to add subscriptions to your app.</p>
<h3 id="when-to-use">When to use subscriptions</h3>

<p>In most cases, intermittent polling or manual refetching are actually the best way to keep your client up to date. So when is a subscription the best option? Subscriptions are especially useful if:</p>
<ol>
<li>The initial state is large, but the incremental change sets are small. The starting state can be fetched with a query and subsequently updated through a subscription.</li>
<li>You care about low-latency updates in the case of specific events, for example in the case of a chat application where users expect to receive new messages in a matter of seconds.</li>
</ol>
<p>A future version of Apollo or GraphQL might include support for live queries, which would be a low-latency way to replace polling, but at this point general live queries in GraphQL are not yet possible outside of some relatively experimental setups.</p>
<h2 id="subscriptions-client">Client setup</h2>

<p>The most popular transport for GraphQL subscriptions today is <a href="https://github.com/apollographql/subscriptions-transport-ws" target="_blank" rel="external"><code>subscriptions-transport-ws</code></a>. This package is maintained by the Apollo community, but can be used with any client or server GraphQL implemenetation. In this article, we’ll explain how to set it up on the client, but you’ll also need a server implementation. You can <a href="/tools/graphql-subscriptions/setup.html">read about how to use subscriptions with a JavaScript server</a>, or enjoy subscriptions set up out of the box if you are using a GraphQL backend as a service like <a href="https://www.graph.cool/docs/tutorials/worldchat-subscriptions-example-ui0eizishe/" target="_blank" rel="external">Graphcool</a> or <a href="https://scaphold.io/blog/2016/11/09/build-realtime-apps-with-subs.html" target="_blank" rel="external">Scaphold</a>.</p>
<p>Let’s look at how to add support for this transport to Apollo Client.</p>
<p>First, install <code>subscriptions-transport-ws</code> from npm:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save subscriptions-transport-ws</div></pre></td></tr></table></figure>
<p>Then, initialize a GraphQL subscriptions transport client:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; SubscriptionClient &#125; <span class="keyword">from</span> <span class="string">'subscriptions-transport-ws'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> wsClient = <span class="keyword">new</span> SubscriptionClient(<span class="string">`ws://localhost:5000/`</span>, &#123;</div><div class="line">  <span class="attr">reconnect</span>: <span class="literal">true</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Then, extend your existing Apollo Client network interface using the <code>addGraphQLSubscriptions</code> function:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; ApolloClient, createNetworkInterface &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</div><div class="line"><span class="keyword">import</span> &#123; SubscriptionClient, addGraphQLSubscriptions &#125; <span class="keyword">from</span> <span class="string">'subscriptions-transport-ws'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Create a normal network interface:</span></div><div class="line"><span class="keyword">const</span> networkInterface = createNetworkInterface(&#123;</div><div class="line">  <span class="attr">uri</span>: <span class="string">'http://localhost:3000'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Extend the network interface with the WebSocket</span></div><div class="line"><span class="keyword">const</span> networkInterfaceWithSubscriptions = addGraphQLSubscriptions(</div><div class="line">  networkInterface,</div><div class="line">  wsClient</div><div class="line">);</div><div class="line"></div><div class="line"><span class="comment">// Finally, create your ApolloClient instance with the modified network interface</span></div><div class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</div><div class="line">  <span class="attr">networkInterface</span>: networkInterfaceWithSubscriptions</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Now, queries and mutations will go over HTTP as normal, but subscriptions will be done over the websocket transport.</p>
<h2 id="subscribe-to-more">subscribeToMore</h2>

<p>With GraphQL subscriptions your client will be alerted on push from the server and you should choose the pattern that fits your application the most:</p>
<ul>
<li>Use it as a notification and run any logic you want when it fires, for example alerting the user or refetching data</li>
<li>Use the data sent along with the notification and merge it directly into the store (existing queries are automatically notified)</li>
</ul>
<p>With <code>subscribeToMore</code>, you can easily do the latter.</p>
<p><code>subscribeToMore</code> is a function available on every query result in <code>react-apollo</code>. It works just like <a href="/react/cache-updates.html#fetchMore"><code>fetchMore</code></a>, except that the update function gets called every time the subscription returns, instead of only once.</p>
<p>Here is a regular query:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; CommentsPage &#125; <span class="keyword">from</span> <span class="string">'./comments-page.js'</span>;</div><div class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</div><div class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> COMMENT_QUERY = gql<span class="string">`</span></div><div class="line">    query Comment($repoName: String!) &#123;</div><div class="line">      entry(repoFullName: $repoName) &#123;</div><div class="line">        comments &#123;</div><div class="line">          id</div><div class="line">          content</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">`;</div><div class="line"></div><div class="line"><span class="keyword">const</span> withData = graphql(COMMENT_QUERY, &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'comments'</span>,</div><div class="line">    <span class="attr">options</span>: <span class="function">(<span class="params">&#123; params &#125;</span>) =&gt;</span> (&#123;</div><div class="line">        <span class="attr">variables</span>: &#123;</div><div class="line">            <span class="attr">repoName</span>: <span class="string">`<span class="subst">$&#123;params.org&#125;</span>/<span class="subst">$&#123;params.repoName&#125;</span>`</span></div><div class="line">        &#125;,</div><div class="line">    &#125;)</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> CommentsPageWithData = withData(CommentsPage);</div></pre></td></tr></table></figure>
<p>Now, let’s add the subscription.</p>
<p>Add a function called <code>subscribeToNewComments</code> that will subscribe using <code>subscribeToMore</code> and update the query’s store with the new data using <code>updateQuery</code>.</p>
<p>Note that the <code>updateQuery</code> callback must return an object of the same shape as the initial query data, otherwise the new data won’t be merged. Here the new comment is pushed in the <code>comments</code> list of the <code>entry</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> COMMENTS_SUBSCRIPTION = gql<span class="string">`</span></div><div class="line">    subscription onCommentAdded($repoFullName: String!)&#123;</div><div class="line">      commentAdded(repoFullName: $repoFullName)&#123;</div><div class="line">        id</div><div class="line">        content</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">`;</div><div class="line"></div><div class="line"><span class="keyword">const</span> withData = graphql(COMMENT_QUERY, &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'comments'</span>,</div><div class="line">    <span class="attr">options</span>: <span class="function">(<span class="params">&#123; params &#125;</span>) =&gt;</span> (&#123;</div><div class="line">        <span class="attr">variables</span>: &#123;</div><div class="line">            <span class="attr">repoName</span>: <span class="string">`<span class="subst">$&#123;params.org&#125;</span>/<span class="subst">$&#123;params.repoName&#125;</span>`</span></div><div class="line">        &#125;,</div><div class="line">    &#125;),</div><div class="line">    <span class="attr">props</span>: <span class="function"><span class="params">props</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">subscribeToNewComments</span>: <span class="function"><span class="params">params</span> =&gt;</span> &#123;</div><div class="line">                <span class="keyword">return</span> props.comments.subscribeToMore(&#123;</div><div class="line">                    <span class="attr">document</span>: COMMENTS_SUBSCRIPTION,</div><div class="line">                    <span class="attr">variables</span>: &#123;</div><div class="line">                        <span class="attr">repoName</span>: params.repoFullName,</div><div class="line">                    &#125;,</div><div class="line">                    <span class="attr">updateQuery</span>: <span class="function">(<span class="params">prev, &#123;subscriptionData&#125;</span>) =&gt;</span> &#123;</div><div class="line">                        <span class="keyword">if</span> (!subscriptionData.data) &#123;</div><div class="line">                            <span class="keyword">return</span> prev;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="keyword">const</span> newFeedItem = subscriptionData.data.commentAdded;</div><div class="line"></div><div class="line">                        <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, prev, &#123;</div><div class="line">                            <span class="attr">entry</span>: &#123;</div><div class="line">                                <span class="attr">comments</span>: [newFeedItem, ...prev.entry.comments]</div><div class="line">                            &#125;</div><div class="line">                        &#125;);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>and start the actual subscription by calling the <code>subscribeToNewComments</code> function with the subscription variables:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CommentsPage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> propTypes = &#123;</div><div class="line">        <span class="attr">repoFullName</span>: PropTypes.string.isRequired,</div><div class="line">        <span class="attr">subscribeToNewComments</span>: PropTypes.func.isRequired,</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    componentWillMount() &#123;</div><div class="line">        <span class="keyword">this</span>.props.subscribeToNewComments(&#123;</div><div class="line">            <span class="attr">repoFullName</span>: <span class="keyword">this</span>.props.repoFullName,</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="authentication">Authentication over WebSocket</h2>

<p>In many cases it is necessary to authenticate clients before allowing them to receive subscription results. To do this, the <code>SubscriptionClient</code> constructor accepts a <code>connectionParams</code> field, which passes a custom object that the server can use to validate the connection before setting up any subscriptions.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;SubscriptionClient&#125; <span class="keyword">from</span> <span class="string">'subscriptions-transport-ws'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> wsClient = <span class="keyword">new</span> SubscriptionClient(<span class="string">`ws://localhost:5000/`</span>, &#123;</div><div class="line">    <span class="attr">reconnect</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">connectionParams</span>: &#123;</div><div class="line">        <span class="attr">authToken</span>: user.authToken,</div><div class="line">    &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>You can use <code>connectionParams</code> for anything else you might need, not only authentication, and check its payload on the server side with <a href="/tools/graphql-subscriptions/index.html">SubscriptionsServer</a>.</p>
</blockquote>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="mutations.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Mutations
        </a>
      
      
        <a class="link primary next"
          href="receiving-updates.html">
          <span class="subtitle-pagination">Next</span>
          Syncing with the Server
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/apollographqlcn/react-docs-cn/tree/master/source/subscriptions.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/react-docs-cn/script/smooth-scroll.min.js"></script>
    <script src="/react-docs-cn/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
      // nectar ninja
      (function(){
        var handle = '@meteorjs';
        var a = document.createElement('script');
        var m = document.getElementsByTagName('script')[0];
        a.async = 1;
        a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1);
        m.parentNode.insertBefore(a, m);
      })();

     

      
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PNFDVBB');
      

      
        // Segment Tracking
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
        analytics.load("wgrIo8Bul0Ujl8USETG3DB6hONdy4kTg");
        analytics.page()
        }}();
      

      // search box
      

        ['desktop', 'mobile'].forEach(function(type) {
          var search = docsearch({
            apiKey: '768e823959d35bbd51e4b2439be13fb7',
            indexName: 'apollodata',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
              dropdownMenuContainer: '.wrapper-' + type + '-search-results',
              debug: true
            },
            algoliaOptions: {
              hitsPerPage: 20
            }
          }).autocomplete;

          var sidebar = document.querySelector('.sidebar-content');
          search.on('autocomplete:opened', function() {
            sidebar.classList.add('searching');
          });
          search.on('autocomplete:closed', function() {
            sidebar.classList.remove('searching');
          });
          search.on('autocomplete:updated', function() {
            if (search.val() === '') {
              search.autocomplete.close();
            }
          });
        });
      

      
    </script>
  </body>
</html>
